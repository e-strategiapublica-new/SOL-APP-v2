<div class="container-fluid mb-6">
  <div class="row mt-5">
    <div class="col-md-12">
      <h1>{{"SUPPLIER_BIDDING.BIDDING_INFORMATION" | translate}}</h1>
      <hr class="bg-secondary">
    </div>
  </div>

  <div class="row mt-1">
    <div class="col-12">
      <i class="fa fa-arrow-left f-size-24 cursor-pointer" [routerLink]="['/pages/associacao/licitacoes']"
        aria-hidden="true"></i>
    </div>
  </div>

  <div class="row mt-3">
    <div class="col-12">
      <div class="col-md-12 col-lg-12 col-xl-10">
        <div class="row p-3 user-data-border">
          <div class="col-12 user-data-border">
            <h3 class="text-danger text-center f-size-16 pt-1">{{response.declined_reason}}</h3>
          </div>
          <div class="row col-12 p-2">

            <div class="col-12 col-md-10">
              <h3 class="text-dark">{{response.bid_count+'/'+(
                date.getFullYear())}}</h3>
            </div>
            <div class="col-12 col-md-2">
              <h6 class="font-poppins f-size-14 text-secondary">Status</h6>
              <h5 *ngIf="response.status ==='awaiting'" class="f-size-16 text-warning">
                {{'ADMINISTRATION_BIDDING.AWAITING' | translate}}</h5>
              <h5 *ngIf="response.status ==='tiebreaker'" class="f-size-16 text-warning">
                {{'ADMINISTRATION_BIDDING.TIEBREAKER' | translate}}</h5>
              <h5 *ngIf="response.status ==='analysis'" class="f-size-16 text-info">{{'ADMINISTRATION_BIDDING.ANALYSIS'
                | translate}}</h5>
              <h5 *ngIf="response.status ==='deserted'" class="f-size-16 text-danger">
                {{'ADMINISTRATION_BIDDING.DESERTED' | translate}}</h5>
              <h5 *ngIf="response.status ==='canceled'" class="f-size-16 text-danger">
                {{'ADMINISTRATION_BIDDING.CANCELED' | translate}}</h5>
              <h5 *ngIf="response.status ==='failed'" class="f-size-16 text-danger">{{'ADMINISTRATION_BIDDING.FAILED'
                |
                translate}}</h5>
              <h5 *ngIf="response.status ==='draft'" class="f-size-16 text-dark">{{'ADMINISTRATION_BIDDING.DRAFT'
                |
                translate}}</h5>
              <h5 *ngIf="response.status ==='released'" class="f-size-16 text-success">
                {{'ADMINISTRATION_BIDDING.RELEASED' | translate}}</h5>
              <h5 *ngIf="response.status ==='open'" class="f-size-16 text-success">{{'ADMINISTRATION_BIDDING.OPEN' |
                translate}}</h5>
              <h5 *ngIf="response.status ==='completed'" class="f-size-16 text-success">
                {{'ADMINISTRATION_BIDDING.COMPLETED' | translate}}</h5>
              <h5 *ngIf="response.status ==='reopened'" class="f-size-16 text-success">
                {{'ADMINISTRATION_BIDDING.REOPENED' | translate}}</h5>
              <h5 *ngIf="response.status ==='returned'" class="f-size-16 text-info">{{"CREATE_BIDDING_STATUS.RETURNED" |
                translate}}</h5>
            </div>
          </div>

          <div class="row col-12 p-2">
            <div class="col-12 col-md-10">
              <h6 class="font-poppins f-size-14 text-secondary">{{'ASSOCIATION_AGREEMENTS.ASSOCIATION'
                | translate}}
              </h6>
              <p class="f-size-16 text-dark">{{response?.association?.name}}</p>
            </div>
            <div class="col-12 col-md-2">
              <h6 class="font-poppins f-size-14 text-secondary">{{'ASSOCIATION_AGREEMENTS.REVIWER'
                | translate}}</h6>
              <h6 class="f-size-16 text-dark">Adm Geral</h6>
            </div>
          </div>

          <div class="row col-12 p-2">
            <div class="col-12 col-md-6">
              <h6 class="font-poppins f-size-14 text-secondary">{{'ADMINISTRATION_BIDDING.MODALITY'
                | translate}}</h6>
              <h5 *ngIf="response.modality ==='openClosed'" class="f-size-16 text-dark">
                {{'ADMINISTRATION_BIDDING.PUBLIC' | translate}}</h5>
              <h5 *ngIf="response.modality ==='openInvite'" class="f-size-16 text-dark">
                {{'ADMINISTRATION_BIDDING.INVITATION_OPEN' | translate}}</h5>
              <h5 *ngIf="response.modality ==='closedInvite'" class="f-size-16 text-dark">
                {{'ADMINISTRATION_BIDDING.INVITATION_CLOSED' | translate}}</h5>
            </div>
            <div class="col-12 col-md-6">
              <h6 class="font-poppins f-size-14 text-secondary">{{'ADMINISTRATION_BIDDING.CLASSIFICATION'
                | translate}}
              </h6>
              <h6 class="f-size-16 text-dark">{{response?.classification}}</h6>
            </div>
          </div>

          <div class="row col-12 p-2">
            <div class="col-12 col-md-6">
              <h6 class="font-poppins f-size-14 text-secondary">{{'ADMINISTRATION_BIDDING_DETAIL.DEADLINE_DELIVERY'
                |
                translate}}</h6>
              <h6 class="f-size-16 text-dark">{{response.days_to_delivery}} {{'SUPPLIER_BIDDING.DAYS'
                | translate}}</h6>
            </div>
            <div class="col-12 col-md-4">
              <h6 class="font-poppins f-size-14 text-secondary">{{'CREATE_BIDDING.START_DATE'
                | translate}}</h6>

              <p *ngIf="response.status !== 'returned' && response.status !== 'awaiting' && response.status !== 'draft'" class="text-dark">{{response.start_at | date: 'dd/MM/yyyy, h:mm a'}}</p>

            </div>
            <div class="col-12 col-md-2">
              <h6 class="font-poppins f-size-14 text-secondary">{{'CREATE_BIDDING.CLOSING_DATE'
                | translate}}</h6>
              <h6 *ngIf="response.status !== 'returned' && response.status !== 'awaiting' && response.status !== 'draft'" class="f-size-16 text-dark">{{response.end_at | date:
                'dd/MM/yyyy'}}</h6>
            </div>
          </div>

          <div class="row col-12 p-2">
            <div class="col-12 col-md-6">
              <h6 class="font-poppins f-size-14 text-secondary">{{'CREATE_BIDDING.DELIVERY_PLACE'
                | translate}}</h6>
              <p class="text-dark">{{response.local_to_delivery}}</p>
            </div>
            <div class="col-12 col-md-6">
              <h6 class="font-poppins f-size-14 text-secondary">{{'ADMINISTRATION_BIDDING_DETAIL.DAYS_TIEBREAKER'
                |
                translate}}</h6>
              <h6 class="f-size-16 text-dark">{{response.days_to_tiebreaker}}</h6>
            </div>
          </div>

          <div class="row col-12 p-2">
            <div class="col-12 col-md-6">
              <h6 class="font-poppins f-size-14 text-secondary">{{'ADMINISTRATION_BIDDING_DETAIL.TYPE_BID'
                | translate}}
              </h6>
              <h5 *ngIf="response.bid_type ==='individualPrice'" class="f-size-16">
                {{'ADMINISTRATION_BIDDING_DETAIL.INDIVIDUAL_PRICE' | translate}}</h5>
              <h5 *ngIf="response.bid_type ==='allotmentPrice'" class="f-size-16">
                {{'ADMINISTRATION_BIDDING_DETAIL.ALLOTMENT_PRICE' | translate}}</h5>
              <h5 *ngIf="response.bid_type ==='globalPrice'" class="f-size-16">
                {{'ADMINISTRATION_BIDDING_DETAIL.GLOBAL_PRICE' | translate}}</h5>
            </div>
            <div class="col-12 col-md-6">
              <h6 class="font-poppins f-size-14 text-secondary">{{'SIDEBAR.AGREEMENTS'
                | translate}}</h6>
              <h6 class="f-size-16 text-dark">
                {{response.agreement?.register_number+" - "+response.agreement?.register_object
                }}</h6>
            </div>
          </div>

          <div class="row col-6 p-2">
            <div class="col-12 col-md-12">
              <h6 class="font-poppins f-size-14 text-secondary">{{'ADMINISTRATION_BIDDING.DESCRIPTION'
                | translate}}
              </h6>
              <p class="text-dark">{{response?.description}}</p>
            </div>
            <div class="col-12 col-md-12">
              <h6 class="font-poppins f-size-14 text-secondary">{{'CREATE_BIDDING.WEBSITE'
                | translate}}</h6>
              <h6 class="f-size-16 text-dark">{{response.aditional_site}}</h6>
            </div>
          </div>

          <div class="row col-12 col-md-6 p-2">
            <div class="col-12">
              <button *ngIf="response.status === 'returned' " (click)="downloadEdital()" type="button"
                class="bg-light btn-lg btn-block mb-4 text-small">{{"DOWNLOAD_EDITAL_DRAFT" | translate}}</button>
              <button *ngIf="response.status !=='draft' && response.status !== 'returned' " (click)="downloadEdital()"
                type="button" class="bg-light btn-lg btn-block mb-4 text-small">{{"SUPPLIER_BIDDING.DOWNLOAD"
                | translate}}</button>
              <button *ngIf="response.status ==='draft'" (click)="downloadEdital()" type="button"
                class="bg-light btn-lg btn-block mb-4 text-small">{{"DOWNLOAD_EDITAL_DRAFT"
                | translate}}</button>
            </div>

            <div class="col-12">
              <button *ngIf="response.additionalDocuments.length !== 0" (click)="downloadComplentary()" type="button" class="bg-light btn-lg btn-block mb-4 text-small">
                {{"DOWNLOAD_COMPLEMENTARY_ARCHIVES" | translate}}</button>
                <button *ngIf="response.additionalDocuments.length === 0" disabled type="button" class="bg-light btn-lg btn-block mb-4 text-small">
                  {{'ADMINISTRATION_BIDDING_DETAIL.WITHOUT_ADDITIONAL_DOCUMENT'   | translate}}</button>
            </div>
            <div class="col-12">
              <button *ngIf="response.status === 'completed'" (click)="openModal('contract', null)" type="button"
                class="bg-light btn-lg btn-block mb-4 text-small">
                {{'ADMINISTRATION_BIDDING_DETAIL.CONTRACT_AGREEMENT' |
                translate}}</button>
            </div>

            <div class="col-12">
              <button *ngIf="response.status === 'completed' " (click)="downloadAta()" type="button"
                class="bg-light btn-lg btn-block mb-4 text-small">
                {{"ADMINISTRATION_BIDDING_DETAIL.DOWNLOAD_ATA" | translate}}</button>
            </div>
          </div>

        </div>

        <div class="row d-flex justify-content-end" *ngIf="user.type !== 'fornecedor'">
          <div class="col-md-4">
            <button class="btn w-100 h50 br-10 btn-danger my-4"
              *ngIf="response.status !== 'canceled' && response.status !== 'awaiting' && response.status !== 'draft' && response.status !== 'returned'"
              (click)="open(content);" type="button">
              <strong>{{"ADMINISTRATION_DETAIL_BID_CANCEL.CANCEL_BID" | translate}}</strong>
            </button>
            <button class="btn w-100 h50 br-10 btn-danger my-4" *ngIf="response.status === 'draft' || response.status === 'returned'" (click)="open(bid);"
              type="button">
              <strong>{{"ENDPOINT_STATUS.DELETE_DRAFT" | translate}}</strong>
            </button>
          </div>
          <div class="col-md-4">
            <button class="btn btn-success w-100 br-10 h50 my-4" *ngIf="response.status === 'draft' || response.status === 'returned'"
              (click)="open(contentAccept);" type="button">
              <strong>{{"SUPPLIER_BIDDING.FINALIZE_SUBMIT" | translate}}</strong>
            </button>
          </div>
        </div>

        <div class="row col-12 mt-6">
          <h4>{{"SUPPLIER_BIDDING.LOTS_ITEMS" | translate}}</h4>
        </div>

        <div *ngFor="let allotment of response.add_allotment" class="row mt-4 m-0 p-3 pe-0 user-data-border">
          <div class="col-12 py-2 px-0 px-sm-3">
            <div class="d-flex align-items-start justify-content-between">
              <div class="col-4 p-0">
                <h6>{{"SUPPLIER_BIDDING.LOT_NUMBER" | translate}}</h6>
                <h6>{{response.bid_count}}</h6>
              </div>
              <div class="col-3 p-0">
                <h6>{{"SIDEBAR.ITEMS" | translate}}</h6>
                <h6>{{allotment.add_item.length}}</h6>
              </div>
              <div class="col-3 p-0 text-end">
                <h6>Status</h6>
                <h6 [ngClass]="getClassStatus(allotment.status)" class="text-capitalize">{{allotment.status || '-'}}
                </h6>
              </div>
              <div class="col-md-1 p-0 d-flex justify-content-end">
                <!-- <img (click)="toggleSectionOne(allotment)" style="width: 16px;"
                  [src]="allotment.isSectionOpen ? '../../../assets/images/arrow-close.svg' : '../../../assets/images/arrow-opener.svg'"
                  alt="Ícone" class="opener-icon cursor-pointer"> -->
                <i class="bi"
                  [ngClass]="{'bi-caret-down-fill': !allotment.isSectionOpen, 'bi-caret-up': allotment.isSectionOpen}"
                  (click)="toggleSectionOne(allotment)"></i>
              </div>
            </div>

            <div class="content" [ngClass]="{ 'open': allotment.isSectionOpen }">
              <hr>
              <h4 class="pb-3">{{"SUPPLIER_BIDDING.LIST_ITEMS_PROPOSALS" |
                translate}} </h4>
              <div class="row col-12 mb-3 p-0 p-sm-2">
                <div class="col-md-12 p-0">
                  <div class="table-responsive-sm">
                    <table class="table table-hover">
                      <thead>
                        <tr class="custom-th-contrato">
                          <th scope="col" style="color: black;">Item</th>
                          <th scope="col"></th>
                          <th scope="col" style="color: black;">{{"CREATE_BIDDING.QUANTITY"
                            | translate}}</th>
                          <th scope="col"></th>
                          <th scope="col" style="color: black;">{{"COST_ITEMS.UNIT_TITLE"
                            | translate}}</th>
                          <th scope="col" style="color: black;">{{"COST_ITEMS.SPECIFICATION"
                            | translate}}</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr class="bg-first-row" *ngFor="let itens of allotment.add_item">
                          <th class="text-capitalize" scope="row">{{ itens.item
                            }}</th>
                          <th scope="col"></th>
                          <td class="text-capitalize">{{ itens.quantity }} {{"SUPPLIER_BIDDING.UNITS"
                            | translate}}</td>
                          <th scope="col"></th>
                          <td class="text-capitalize">{{ itens.unitMeasure }}</td>
                          <td class="text-capitalize">{{ itens.specification }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <div *ngIf="response.editalFile" class="d-flex align-items-center justify-content-between p-0">
                <div class="col-md-4 p-0">
                  <h6>{{"SUPPLIER_BIDDING.LOT_FILES" | translate}}</h6>
                  <h6 (click)="download(allotment._id)" class="text-primary cursor-pointer">
                    {{getFileName(allotment.files)}}</h6>
                </div>
                <div class="col-md-3 mt-4">
                </div>
              </div>
              <button type="button" *ngIf="response.status === 'analysis' && allotment.status === 'emAnalise'"
              (click)="goViewProposals()"
              class="bg-dark btn-lg btn-block mb-4 text-small text-white">{{"ADMINISTRATION_BIDDING_DETAIL.VIEW_PROPOSAL"
              | translate}}</button>
              <!-- <button *ngIf="response.status === 'analysis'  || response.status === 'completed' " type="button"
                (click)="goViewProposals()"
                class="bg-dark btn-lg btn-block mb-4 text-small text-white">{{"ADMINISTRATION_BIDDING_DETAIL.VIEW_PROPOSAL"
                | translate}}</button> -->
            </div>
          </div>
        </div>

        <div class="row col-12 mt-5">
          <h4>{{"SUPPLIER_BIDDING.INVITED_SUPPLIERS" | translate}}</h4>
        </div>
        <div class="row col-12 col-md-12 mt-4 p-0 m-0 user-data-border mb-5"
          *ngFor="let response of response.invited_suppliers">
          <div class="col-12">
            <div class="row d-flex align-items-center justify-content-between p-3">
              <div class="col-md-9 p-0">
                <h6>{{"SIDEBAR.SUPPLIER" | translate}}</h6>
                <h6>{{response.name}}</h6>
              </div>
              <div class="col-md-3 p-0 d-flex align-items-center justify-content-end">
                <div class="pr-5">
                  <h6>{{"SUPPLIER_BIDDING.DOCUMENT" | translate}}</h6>
                  <h6>{{response.cpf | mask : '000.000.000-00'}}</h6>
                </div>
                <!-- <img (click)="toggleSectionTwo()" style="width: 16px;"
                  [src]="isSectionTwoOpen ? '../../../' : '../../../assets/images/arrow-opener.svg'"
                  alt="Ícone"
                  class="opener-icon cursor-pointer"> -->
                <i class="bi text-center"
                  [ngClass]="{'bi-caret-down-fill': !isSectionTwoOpen, 'bi-caret-up': isSectionTwoOpen}"
                  (click)="toggleSectionTwo()"></i>
              </div>
            </div>

            <div class="content" [ngClass]="{ 'open': isSectionTwoOpen }">
              <hr>
              <h6 class="text-dark">{{"SUPPLIER_BIDDING.ADDRESS" | translate}}</h6>
              <div class="row d-flex align-items-center justify-content-between p-3">
                <div class="col-md-4 p-0">
                  <h6>{{"SUPPLIER_BIDDING.STREET" | translate}}</h6>
                  <h6>{{response.address.publicPlace}}</h6>
                </div>
                <div class="col-md-2 p-0">
                  <h6>{{"ASSOCIATION_AGREEMENTS.NUMBER" | translate}}</h6>
                  <h6>{{response.address.number}}</h6>
                </div>
                <div class="col-md-2 p-0">
                  <h6>{{"SUPPLIER_BIDDING.NEIGHBORHOOD" | translate}}</h6>
                  <h6>{{response.address.neighborhood}}</h6>
                </div>
                <div class="col-md-2 p-0">
                  <h6>{{"SUPPLIER_BIDDING.CITY" | translate}}</h6>
                  <h6>{{response.address.city}}</h6>
                </div>
                <div class="col-md-2 p-0">
                  <h6>{{"SUPPLIER_BIDDING.ZIP_CODE" | translate}}</h6>
                  <h6>{{response.address.zipCode}}</h6>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row col-12 col-md-12 mt-2 p-0 m-0 mb-5"
          *ngIf="!response?.invited_suppliers.length">
          <p class="mx-2">{{"SUPPLIER_BIDDING.NO_INVITED_SUPPLIERS" | translate}}</p>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template class="container-fluid" #content let-modal>
  <div class="p-5 bg-light">
    <div class="col-12 d-flex justify-content-between">
      <h3 class="tfa-title m-0">{{"ADMINISTRATION_DETAIL_BID_CANCEL.CANCEL_BID"
        | translate}}</h3>
      <h5 (click)="exit()" class="cursor-pointer">X</h5>
    </div>
    <div class="my-4 text-center block-messege py-1 d-flex justify-content-center">
      <div class="pr-1"><img src="../../../../assets/images/icon-alert.svg" (click)="exit()"></div>
      <div class="danger-text">{{"SUPPLIER_BIDDING.CANCEL_BIDDING" | translate}}</div>
    </div>

    <div class="d-flex justify-content-center">
      <div class="col-md-6 mt-4">
        <button type="button" class="bg-light btn-lg btn-block mb-4 text-small border-0"
          (click)="exit();">{{"BUTTON_TEXT.BACK" | translate}}</button>
      </div>

      <div class="col-md-6 mt-4">
        <button type="button" class="btn-block-supplier text-white btn-lg btn-block mb-4 text-small border-0"
          (click)="cancelStatus();">{{"BUTTON_TEXT.CONFIRM" | translate}}</button>
      </div>
    </div>
  </div>
</ng-template>

<ng-template class="container-fluid" #bid let-modal>
  <div class="p-5 bg-light">
    <div class="col-12 d-flex justify-content-between">
      <h3 class="tfa-title m-0">{{"ENDPOINT_STATUS.DELETE_BID" | translate}}</h3>
      <h5 (click)="exit()" class="cursor-pointer">X</h5>
    </div>

    <div class="my-4 text-center block-messege py-1 d-flex justify-content-center">
      <div class="pr-1"><img src="../../../../assets/images/icon-alert.svg" (click)="exit()"></div>
      <div class="danger-text">{{"SUPPLIER_BIDDING.DELETE_BIDDING" | translate}}</div>
    </div>

    <div class="d-flex justify-content-center">
      <div class="col-md-6 mt-4">
        <button type="button" class="bg-light btn-lg btn-block mb-4 text-small border-0"
          (click)="exit();">{{"BUTTON_TEXT.BACK" | translate}}</button>
      </div>

      <div class="col-md-6 mt-4">
        <button type="button" class="btn-block-supplier text-white btn-lg btn-block mb-4 text-small border-0"
          (click)="confirmDeleteBid();">{{"BUTTON_TEXT.CONFIRM" | translate}}</button>
      </div>
    </div>
  </div>
</ng-template>

<ng-template class="container-fluid" #contentAccept let-modal>
  <div class="p-5 bg-light">
    <div class="col-12 d-flex justify-content-between">
      <h3 class="tfa-title m-0">{{"SUPPLIER_BIDDING.ACCEPT_BID" | translate}}</h3>
      <h5 (click)="exit()" class="cursor-pointer">X</h5>
    </div>

    <div class="my-4 text-center accept-messege py-1 d-flex justify-content-center">
      <div class="pr-1"><img src="../../../../assets/images/icon-alert.svg" (click)="exit()"></div>
      <div class="text-primary">{{"SUPPLIER_BIDDING.APPROVAL_ACTION" |
        translate}}</div>
    </div>

    <div class="d-flex justify-content-center">
      <div class="col-md-6 mt-4">
        <button type="button" class="bg-light btn-lg btn-block mb-4 text-small border-0"
          (click)="exit();">{{"BUTTON_TEXT.BACK" | translate}}</button>
      </div>

      <div class="col-md-6 mt-4">
        <button type="button" class="btn-info text-white btn-lg btn-block mb-4 text-small border-0"
          (click)="acceptStatus()">{{"BUTTON_TEXT.CONFIRM" | translate}}</button>
      </div>
    </div>
  </div>
</ng-template>